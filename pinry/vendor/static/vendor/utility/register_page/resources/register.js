/*!
 * 注册账户
 * 
 * @author lovemoon@yeah.net
 * @since 2011-07-16
 */
jQuery(function(){var b=jQuery(".reg-form-sec :input.input-text").focus(function(){jQuery(this).parents(".item:first").removeClass("success").addClass("focus")}).blur(function(){var d=jQuery(this);var c=d.parents(".item:first");if(d.val()==""){c.removeClass("focus")}});b.each(function(){var c=jQuery(this);c.triggerHandler("focus");c.triggerHandler("blur")});var a=b.filter(":visible").eq(0);if(a.size()>0){a.focus().setCaret(a.val().length)}});var ValidatorComponent={list:[],add:function(a){this.list.push(a)},isValid:function(){var a=true;for(var c=0;c<this.list.length;c++){var b=this.list[c];if(b.isValid()===false){a=false}}return a},init:function(){for(var a=0;a<this.list.length;a++){this.list[a].init()}}};
/*!
 * Email 校验器
 */
var EmailValidator={regExp:/^([\w-])+(\.\w+)*@([\w-])+((\.\w+)+)$/,cache:new Cache(20),init:function(){this.input=jQuery(":input[name=email]");this.input.blur(jQuery.proxy(this,"isValid"))},isValid:function(g){var c=this;var b=this.input;var f=b.parents(".item:first");var a=f.find(".tips");var d=jQuery.trim(b.val());b.val(d);if(g&&g.type=="blur"&&d==""){return false}if(!this.regExp.test(d)){a.html("邮箱格式好像不对哦").show();f.removeClass("success focus").addClass("error");return false}if(this.cache.getItem(d)!=null){return this.remoteCheck(this.cache.getItem(d))}jQuery.ajax({url:"http://www.meile.com/register/checkemail",data:{email:d},type:"post",dataType:"json",beforeSend:function(){a.html("正在检查...").show()},success:function(e){if(e){c.cache.setItem(d,e);c.remoteCheck(e)}else{a.html("服务器异常，请稍候再试！")}},error:function(e){if(e.statusText!="abort"){a.html("好像网络有点问题哦...")}}});return true},remoteCheck:function(d){var c=this.input.parents(".item:first");var a=c.find(".tips");if(d.code==0){c.removeClass("error focus").addClass("success");a.hide();return true}else{var b=d.values.message;if(b=="邮箱已存在啦"){b+='<br /><a href="/login">点此登录</a>'}a.html(b).show();c.removeClass("success focus").addClass("error");return false}}};ValidatorComponent.add(EmailValidator);var PasswordValidator={init:function(){this.input=jQuery(":input[name=password]");this.input.blur(jQuery.proxy(this,"isValid"))},isValid:function(f){var b=this.input;var c=b.val();if(f&&f.type=="blur"&&c==""){return false}var d=b.parents(".item:first");var a=d.find(".tips");if(c.length<6){a.html("密码不能少于6位").show();d.removeClass("success focus").addClass("error")}else{a.hide();d.removeClass("error focus").addClass("success")}return true}};ValidatorComponent.add(PasswordValidator);
/*!
 * Nickname 验证器
 */
var NicknameValidator={regExp:/^[0-9a-z\u4e00-\u9fa5_]{2,20}$/i,cache:new Cache(20),init:function(){this.input=jQuery("input[name=name]");this.input.blur(jQuery.proxy(this,"isValid"))},isValid:function(g){var c=this;var b=this.input;var d=b.val();var f=b.parents(".item:first");var a=f.find(".tips");if(g&&g.type=="blur"&&d==""){return false}if(this.regExp.test(d)===false){a.html("昵称只允许4-20位的中英文、数字和下划线").show();f.removeClass("success focus").addClass("error");return false}if(this.cache.getItem(d)!=null){return this.remoteCheck(this.cache.getItem(d))}jQuery.ajax({url:"http://www.meile.com/register/checkname",data:{name:d},type:"post",dataType:"json",beforeSend:function(){a.html("正在检查...").show()},success:function(e){if(e){c.cache.setItem(d,e);c.remoteCheck(e)}else{a.html("服务器异常，请稍候再试！")}},error:function(e){if(e.statusText!="abort"){a.html("好像网络有点问题哦...")}}});return false},remoteCheck:function(c){var b=this.input.parents(".item:first");var a=b.find(".tips");if(c.code==0){b.removeClass("error focus").addClass("success");a.hide();return true}else{b.removeClass("success focus").addClass("error");a.html(c.values.message).show();return false}}};ValidatorComponent.add(NicknameValidator);jQuery(function(){ValidatorComponent.init();jQuery("#email,#password,#nickname").focus(function(){jQuery(this).parents(".item:first").find(".suggest").show()}).blur(function(){jQuery(this).parents(".item:first").find(".suggest").hide()});var a=jQuery("form[name=reg-form]");a.trigger("reset");a.submit(function(){var b=false;if(ValidatorComponent.isValid()===false){b=true}if(!jQuery("#pCode").is(":hidden")&&jQuery("#code").val()==""){jQuery("#code").parents(".item:first").removeClass("success focus").addClass("error");b=true}if(jQuery("#protocal").is(":checked")===false){jQuery("#protocal").parents(".item:first").find(".tips-accept").html("请阅读并同意使用协议").show();b=true}else{jQuery("#protocal").parents(".item:first").find(".tips-accept").hide()}if(b===true){return false}var c=a.serializeArray();jQuery.each(c,function(e,f){if(f.name=="password"){f.value=calcMD5(f.value)}});var d=jQuery(".submit-wraper input[type=submit]");jQuery.ajax({url:a.attr("action"),data:c,type:"post",dataType:"json",beforeSend:function(){d.val("正在执行")},success:function(e){if(e&&e.code==0){d.val("注册成功");location.href=e.values.aurl}else{d.val("注册");jQuery.message((e&&e.values.message)||"服务器异常！")}},error:function(){d.val("注册")}});return false})});jQuery(function(){var d=jQuery("#introduce");var b=d.find("li");var c=0;function a(){var e=c;c=c+1;if(c>=b.length){c=0}b.eq(c).fadeIn(1000);b.eq(e).fadeOut(1000)}b.not(":first").css({display:"none"});setInterval(a,5000)});jQuery(function(){jQuery.ajax({url:"/register/getCode",type:"post",dataType:"json",beforeSend:function(){},success:function(a){if(a.code==0){}else{jQuery("#pCode").show()}}})});function changeCodeImg(){var a=(new Date()).valueOf();jQuery("#codeImg").attr("src","/identify/code.jpg?r="+a)}jQuery(function(){var d=jQuery(".otherAccountWeibo");d.hover(function(){d.addClass("otherAccountWeibo_hover")},function(){d.removeClass("otherAccountWeibo_hover")});var b=jQuery(".otherAccountQQ");b.hover(function(){b.addClass("otherAccountQQ_hover")},function(){b.removeClass("otherAccountQQ_hover")});var c=jQuery(".otherAccountRenren");c.hover(function(){c.addClass("otherAccountRenren_hover")},function(){c.removeClass("otherAccountRenren_hover")});var a=jQuery(".otherAccountKaixin");a.hover(function(){a.addClass("otherAccountKaixin_hover")},function(){a.removeClass("otherAccountKaixin_hover")})});