/*!
 * 登录注册
 * 
 * @author lovemoon@yeah.net
 * @since 2011-07-16
 */
var LoginController={form:null,tips:null,accountInput:null,passwordInput:null,init:function(){this.form=jQuery("form[name=login]");this.tips=jQuery(".login-part .tips");this.accountInput=jQuery(":input[name=account]");this.passwordInput=jQuery(":input[name=password]");this.codeInput=jQuery(":input[name=code]");this.bindEvent();this.bindOtherAccountEvent()},isValid:function(){var a=this.tips;var c=this.accountInput;var b=this.passwordInput;var d=this.codeInput;if(jQuery.trim(c.val())==""){a.html("请填写您的账户").show();c.focus().parents(".item:first").removeClass("success").addClass("error");return false}else{a.hide();c.parents(".item:first").removeClass("error").addClass("success")}if(jQuery.trim(b.val())==""){a.html("请填写您的密码").show();b.focus().parents(".item:first").removeClass("success").addClass("error");return false}else{a.hide();b.parents(".item:first").removeClass("error").addClass("success")}if(!d.is(":hidden")&&jQuery.trim(d.val())==""){a.html("请填写验证码").show();d.focus().parents(".item:first").removeClass("success").addClass("error");return false}else{a.hide();d.parents(".item:first").removeClass("error").addClass("success")}return true},bindEvent:function(){var a=this;jQuery(".input-text").focus(function(){jQuery(this).parents(".item:first").removeClass("success").addClass("focus")}).blur(function(){var d=jQuery(this);var c=d.parents(".item:first");c.removeClass("focus");if(d.val()!=""){c.addClass("success")}if(d.attr("name")=="account"){if(jQuery.trim(d.val())!=""){var b={account:d.val()};a.ajaxGetCode(b)}}}).eq(0).focus();this.form.submit(function(){if(a.isValid()===false){return false}var b=a.form.serializeArray();jQuery.each(b,function(c,d){if(d.name=="password"){d.value=calcMD5(d.value)}});a.ajaxLogin(b);return false})},bindOtherAccountEvent:function(){var d=jQuery(".otherAccountWeibo");d.hover(function(){d.addClass("otherAccountWeibo_hover")},function(){d.removeClass("otherAccountWeibo_hover")});var b=jQuery(".otherAccountQQ");b.hover(function(){b.addClass("otherAccountQQ_hover")},function(){b.removeClass("otherAccountQQ_hover")});var c=jQuery(".otherAccountRenren");c.hover(function(){c.addClass("otherAccountRenren_hover")},function(){c.removeClass("otherAccountRenren_hover")});var a=jQuery(".otherAccountKaixin");a.hover(function(){a.addClass("otherAccountKaixin_hover")},function(){a.removeClass("otherAccountKaixin_hover")})},ajaxGetCode:function(a){jQuery.ajax({url:"/getCode",data:a,type:"post",dataType:"json",beforeSend:function(){},success:function(b){if(b.code==0){jQuery("#pCode").hide();jQuery("#pCodeImg").hide()}else{jQuery("#pCode").show();jQuery("#pCodeImg").show()}}})},ajaxLogin:function(b){var a=this;jQuery.ajax({url:a.form.attr("action"),data:b,type:"post",dataType:"json",beforeSend:function(){a.tips.html("正在登录...").show()},success:function(c){if(c.code==0){var e=c.values.f||"/";window.location.href=e}else{if(c.code==506){var f=c.values.aurl||"/";window.location.href=f}else{if(c.code==507){a.tips.html('您的账号由于违规操作被冻结，如有疑问：<a href="/feedback">点此申诉</a>').show()}else{if(c.code==1){if(c.values.errorCount>=3){jQuery("#pCode").show();jQuery("#pCodeImg").show()}jQuery("form[name=login] :input").parents(".item").removeClass("success").addClass("error");var d=c.values.message||"邮箱或密码不匹配，请检查是否输入错误！";a.tips.html(d).show()}else{if(c.code==2){jQuery("form[name=login] :input").parents(".item").removeClass("success").addClass("error");a.tips.html("验证码不正确，请重新输入！").show();changeCodeImg()}else{if(c.code==3){jQuery("form[name=login] :input").parents(".item").removeClass("success").addClass("error");a.tips.html("验证码已失效，请重新输入！").show();changeCodeImg()}}}}}}}})}};function changeCodeImg(){var a=(new Date()).valueOf();jQuery("#codeImg").attr("src","/identify/code.jpg?r="+a)}jQuery(function(){LoginController.init()});jQuery.fn.extend({labelholder:function(){return this.each(function(){var b=jQuery(this).bind("drag",function(){return false});if(b.data("hoder")!==true){b.data("hoder",true);var a=jQuery("#"+b.attr("for"));a.bind("input propertychange focus blur keydown",function(c){if(c.type=="keydown"&&!c.ctrlKey&&!c.altKey&&!c.shiftKey&&c.keyCode!=8){b.hide()}else{if(a.val().length>0){b.hide()}else{b.show()}}}).triggerHandler("input")}})}});jQuery(function(){jQuery(".labelholder").labelholder()});